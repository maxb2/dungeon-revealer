name: Deploy wiki


on:
  push:
    paths:
      # Trigger only when wiki directory changes
      - 'wiki/**'
    branches:
      # And only on master branch
      - master

jobs:
  deploy-wiki:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with: 
        # Fetch merge commit and last commit from pull request
        fetch-depth: 2

    - name: Set environment
      run: |
        # Set the author name, author email, and message from the pull request
        echo "::set-env name=ACTION_MAIL::$(git log -n 1 --skip=1 --pretty=format:%ae)"
        echo "::set-env name=ACTION_NAME::$(git log -n 1 --skip=1 --pretty=format:%an)"
        echo "::set-env name=WIKI_PUSH_MESSAGE::$(git log -n 1 --skip=1 --pretty=format:%s)"



    - name: Push Wiki Changes
      uses: docker://decathlon/wiki-page-creator-action:2.0.1
      env:
        GH_PAT: ${{ secrets.GH_PAT }}
        MD_FOLDER: wiki/
        OWNER: dungeon-revealer
        REPO_NAME: dungeon-revealer
